<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:sf="http://faces.santfeliu.org"
                template="person_common.xhtml">

  <ui:param name="objectPage" value="object" />
  
  <ui:define name="content">
    <f:loadBundle basename="org.santfeliu.kernel.web.resources.KernelBundle"
                  var="kernelBundle" />

    <h:panelGroup>

      <div class="formgrid grid pl-2">  
                
        <div class="field col-12 md:col-4 lg:col-2">
          <p:outputLabel for="id" value="#{objectBundle.object_id}" />
          <p:inputText id="id" value="#{personMainBacking.person.personId}" 
                       styleClass="inputfield w-full" readonly="true" />
        </div>
        
        <div class="field col-12 md:col-4 lg:col-2">
          <p:outputLabel for="nif" value="#{kernelBundle.person_nif}" />
          <p:inputText id="nif" value="#{personMainBacking.person.nif}" 
                       styleClass="inputfield w-full"/>
        </div> 

        <div class="field col-12 md:col-4 lg:col-2">
          <p:outputLabel for="passport" value="#{kernelBundle.person_passport}" />
          <p:inputText id="passport" value="#{personMainBacking.person.passport}" 
                       styleClass="inputfield w-full"/>
        </div>           

      </div>
      
      <div class="field col-12 md:col-4">
        <p:outputLabel for="personTypeId" value="#{kernelBundle.person_type}" />

        <p:selectOneMenu id="personTypeId" value="#{personMainBacking.person.personTypeId}"  
                         styleClass="inputfield w-full"
                         filter="true" var="t">
          <f:selectItems value="#{personMainBacking.typedHelper.allTypes}" var="type" 
            itemLabel="#{type.description}" itemValue="#{type.typeId}" />
          <!--
          <p:column>
            <h:outputText value="#{t}" />
          </p:column>
          -->
          <p:column>
            <h:outputText value="#{typeBean.getDescription(t)}" />
          </p:column>            
        </p:selectOneMenu>
      </div>  
      
      <div class="field lg:col-4 md:col-12">
        <p:outputLabel for="name" value="#{kernelBundle.person_name}" />        
        <p:inputText id="name" value="#{personMainBacking.person.name}" 
                     styleClass="inputfield w-full" />
      </div>   
  
      <div class="formgrid grid pl-2"> 
        <div class="field md:col-4 lg:col-2">
          <p:outputLabel for="first_particle" value="#{kernelBundle.person_particle}" />
          <p:selectOneMenu id="first_particle" value="#{personMainBacking.person.firstParticle}"
                           styleClass="inputfield w-full">
            <f:selectItems value="#{personMainBacking.personParticleSelectItems}" />
          </p:selectOneMenu>
        </div>  

        <div class="field md:col-8 lg:col-4">
          <p:outputLabel for="surname1" value="#{kernelBundle.person_surname1}" />        
          <p:inputText id="surname1" value="#{personMainBacking.person.firstSurname}" 
                       styleClass="inputfield w-full" />
        </div>

        <div class="field md:col-4 lg:col-2">
          <p:outputLabel for="second_particle" value="#{kernelBundle.person_particle}" />
          <p:selectOneMenu id="second_particle" value="#{personMainBacking.person.secondParticle}"
                           styleClass="inputfield w-full">
            <f:selectItems value="#{personMainBacking.personParticleSelectItems}" />
          </p:selectOneMenu>
        </div>         

        <div class="field md:col-8 lg:col-4">
          <p:outputLabel for="surname2" value="#{kernelBundle.person_surname2}" />
          <p:inputText id="surname2" value="#{personMainBacking.person.secondSurname}" 
                       styleClass="inputfield w-full"/>
        </div>    
      </div>

      <div class="formgrid grid pl-2">       


        <div class="field col-12 md:col-4 lg:col-2">
          <p:outputLabel for="sex" value="#{kernelBundle.person_sex}" />
          <p:selectOneMenu id="sex" value="#{personMainBacking.person.sex}"
                           styleClass="inputfield w-full">
            <f:selectItems value="#{personMainBacking.sexSelectItems}" />
          </p:selectOneMenu>
        </div> 
        
        <!--TODO: Locale -->
        <div class="field col-12 md:col-4 lg:col-3">
          <p:outputLabel for="birth_date" value="#{kernelBundle.person_birthDate}" />
          <p:datePicker id="birth_date" value="#{personMainBacking.birthDate}" locale="ca"
                        styleClass="inputfield w-full" showIcon="true"
                        monthNavigator="true" yearNavigator="true"/>
        </div> 
        
  
      </div>

      <div class="formgrid grid pl-2">       
       <div class="field col-12 md:col-9 lg:col-6">
          <h:outputLabel for="person_birthCity" value="#{kernelBundle.person_birthCity}:" />
          
          <!--
          <p:cascadeSelect value="#{personMainBacking.person.birthCityId}" >
            <f:selectItems value="#{personMainBacking.citySelectItems}"/>
          </p:cascadeSelect> 
          -->
          <!--
          <p:selectOneMenu id="person_birthCity" value="#{personMainBacking.person.birthCityId}"  
                           styleClass="inputfield w-full"
                           filter="true" var="t" dynamic="true">
            <f:selectItems value="#{personMainBacking.citySelectItems}" var="city" 
              itemLabel="#{city.label}" itemValue="#{city.value}" />
            <p:column>
              <h:outputText value="#{cityBean.getDescription(t)}" />
            </p:column>            
          </p:selectOneMenu> 
          -->
 
          <p:autoComplete id="person_birthCity" styleClass="w-11" inputStyleClass="w-full"
              value="#{personMainBacking.citySelectItem}" 
              maxResults="10" dropdown="false" dropdownMode="blank" cache="true"
              completeMethod="#{personMainBacking.completeCity}"
              converter="selectItemConverter"
              var="item" itemValue="#{item}" itemLabel="#{item.label}"
              minQueryLength="2" queryDelay="1000"
              onclick="this.setSelectionRange(0, this.value.length)">
            <p:column>
              <h:outputText value="#{cityBean.getDescription(item.value)}" />
            </p:column>        
          </p:autoComplete>  
          
          <p:commandButton icon="pi pi-search" oncomplete="PF('countryToStreetDialog').show()"
                           styleClass="ui-button-raised" 
                           action="#{countryToStreetBacking.showCity(personMainBacking.citySelectItem.value)}"
                           alt="#{objectBundle.search}" title="#{objectBundle.search}"
                           ajax="true" />             
     
        </div>
   
        <div class="field col-12 md:col-6 lg:col-4">
          <h:outputLabel for="person_nationality" value="#{kernelBundle.person_nationality}:" />
          <!--
          <p:autoComplete id="person_nacionality" styleClass="w-full"
              value="#{personMainBacking.countrySelectItem}" 
              maxResults="10" dropdown="true" dropdownMode="blank"
              completeMethod="#{personMainBacking.completeCountry}"
              converter="selectItemConverter"
              var="item" itemValue="#{item}" itemLabel="#{item.label}"
              minQueryLength="3" queryDelay="1000"
              onclick="this.setSelectionRange(0, this.value.length)">
            <p:column>
              <h:outputText value="#{item.label}" />
            </p:column>        
          </p:autoComplete>  
          -->

          <p:selectOneMenu id="person_nationality" value="#{personMainBacking.person.nationalityId}"  
                           styleClass="inputfield w-full"
                           filter="true" var="ct">
            <f:selectItems value="#{personMainBacking.countrySelectItems}" var="country" 
              itemLabel="#{country.label}" itemValue="#{country.value}" />
            <p:column>
              <h:outputText value="#{personMainBacking.getCountryLabel(ct)}" />
            </p:column>            
          </p:selectOneMenu>   
         
        </div> 
  
      </div>   

      <div class="formgrid grid pl-2">         
       
      </div>

      <div class="formgrid grid pl-2">
        <div class="field col-12 md:col-6 lg:col-4">
          <h:outputLabel for="person_father" value="#{kernelBundle.person_father}:" />
          <p:inputText value="#{personMainBacking.person.fatherName}" 
                       styleClass="inputfield w-full" />
        </div>
        <div class="field col-12 md:col-6 lg:col-4">
          <h:outputLabel for="person_mother" value="#{kernelBundle.person_mother}:" />
          <p:inputText  value="#{personMainBacking.person.motherName}" styleClass="inputfield w-full" />
        </div>
      </div>      

    </h:panelGroup>
    
    <p:dialog id="countryToStreetDialog" dynamic="true"  modal="true" 
              widgetVar="countryToStreetDialog" styleClass="w-6">

      <ui:include src="country_to_street.xhtml" />

      <div class="text-right pt-3">
        <p:commandButton value="#{objectBundle.select}" 
                         icon="pi pi-check"
                         oncomplete="PF('countryToStreetDialog').hide()" 
                         action="#{personMainBacking.selectCity(countryToStreetBacking.cityId)}"
                         update="person_birthCity" styleClass="ui-button-raised m-1"/> 
        <p:commandButton value="#{objectBundle.close}" 
                         icon="pi pi-times"
                         onclick="PF('countryToStreetDialog').hide()" styleClass="ui-button-raised m-1"
                         global="false"/>
      </div>

    </p:dialog>     


  </ui:define>


</ui:composition>
