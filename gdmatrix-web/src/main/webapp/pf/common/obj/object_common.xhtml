<!-- 
  Defines the regions common to all objects.

  Defines:
    - smart_filter
    - basic_results
    - favorites
    - recents
-->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:sf="http://faces.santfeliu.org"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                template="/templates/#{userSessionBean.template}/objects_template.xhtml">

    <!-- Smart filter -->
    <ui:define name="smart_filter">
      <f:loadBundle basename="org.santfeliu.web.obj.resources.ObjectBundle" 
                    var="objectBundle" />        
      <div class="field">
        <p:outputLabel for="smart_value" value="Cerca #{userSessionBean.selectedMenuItem.getProperty('label')}" />        
        <p:inputText id="smart_value" value="#{templateBacking.searchBacking.smartValue}" 
                     class="inputfield w-full" />
      </div>    

      <div class="buttons text-right">
        <p:commandButton value="#{objectBundle.clear}"
                         ajax="#{objectPage == 'object_search' ? true : false}"
                         action="#{templateBacking.searchBacking.clear}"
                         styleClass="ui-button-raised m-1"
                         update=":mainform:search_results_panel search_accordion"
                         oncomplete="clickSlickDot(2);"/>      
        <p:commandButton id="default_button" value="#{objectBundle.search}"
                         action="#{templateBacking.searchBacking.smartSearch}"
                         process="@parent" 
                         ajax="#{objectPage == 'object_search' ? true : false}" 
                         update="#{objectPage == 'object_search' ? ':mainform:search_results_panel search_accordion' : ''}"
                         styleClass="ui-button-raised m-1" 
                         oncomplete="clickSlickDot(2);"/>
      </div>   
    </ui:define>  
    
    <!-- Basic results -->       
    <ui:define name="basic_results">
      <p:panel header="Cerca recent" rendered="#{templateBacking.basicResults != null}">
        <p:dataTable id="basic_results_table" value="#{templateBacking.basicResults}" var="row"
            paginator="true" size="small" paginatorPosition="bottom" 
            first="#{templateBacking.searchBacking.resultListHelper.firstRowIndex}"
            rows="#{templateBacking.searchBacking.resultListHelper.pageSize}"
            pageLinks="3"
            rendered="#{templateBacking.searchBacking.renderBasicResults}"
            styleClass="basic_results_table">
          <p:column>
            <p:commandLink action="#{templateBacking.show(row)}"
                           ajax="false" update=":mainform:central_column">
              <h:outputText value="#{templateBacking.getDescription(row)}" />
            </p:commandLink>          
          </p:column>   
        </p:dataTable>  
      </p:panel>      
    </ui:define>    

    <!-- Favorites -->
    <ui:define name="favorites">
      <p:dataTable id="favorites_table" value="#{templateBacking.favorites}"
                   var="fav" size="small" styleClass="favorites_table"
                    paginator="true" paginatorPosition="bottom">
        <p:column>
          <p:commandLink action="#{controllerBacking.show(fav.getValue())}" 
                         ajax="false" oncomplete="clickSlickDot(2);"
                         update=":mainform:object_header">
            <h:outputText value="#{templateBacking.getDescription(fav)}" />
          </p:commandLink>
        </p:column>
      </p:dataTable>
    </ui:define> 

    <!-- Recents -->
    <ui:define name="recents">
      <p:tree value="#{templateBacking.recentHistoryTree}" var="node" styleClass="recents_tree" >
        <p:treeNode type="group">
          <h:outputText value="#{templateBacking.getTypeDescription(node.typeId)}" />
        </p:treeNode>
        <p:treeNode>
          <p:outputPanel>
            <p:commandLink action="#{controllerBacking.show(node.typeId, node.objectId)}" ajax="false" oncomplete="clickSlickDot(2);">
              <h:outputText value="#{templateBacking.getPageHistoryDescription(node)}" />
            </p:commandLink>
          </p:outputPanel>
        </p:treeNode>
      </p:tree> 
    </ui:define>

</ui:composition>

