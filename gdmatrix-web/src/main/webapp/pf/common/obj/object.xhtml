<!-- 
  Defines the main region common to all objects on object pages.

  Defines:
    - main
  Inserts:
    - content (tab body)
-->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:sf="http://faces.santfeliu.org"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                template="object_common.xhtml">
    
  <ui:define name="main">  
    <p:panel>    
      <f:facet name="header">
        <div class="flex align-items-center">
          <div class="w-9">            
            <p:outputPanel id="object_header" styleClass="flex align-items-center"> 
              <i class="#{userSessionBean.selectedMenuItem.properties.icon} text-7xl mx-2 my-1"/>                
              <div class="mr-3">
                <p:commandButton  
                  icon="text-2xl ui-icon pi pi-star-fill" 
                  action="#{templateBacking.unmarkFavorite}"
                  styleClass="rounded-button ui-button-flat"
                  rendered="#{templateBacking.favorite}" global="false"
                  process="@this" update="object_header favorites_table"/>                     
                <p:commandButton 
                  icon="text-2xl ui-icon pi pi-star" 
                  action="#{templateBacking.markFavorite}"
                  styleClass="rounded-button ui-button-flat"
                  rendered="#{!templateBacking.favorite}" global="false"
                  process="@this" update="object_header favorites_table"/> 
              </div>                  
              <div>
                <p:outputLabel value="#{templateBacking.getTypeDescription()}" 
                               styleClass="block"
                               rendered="#{templateBacking.getTypeDescription() != null}"/>                
                <p:outputLabel value="#{templateBacking.getDescription()}" 
                               styleClass="block text-2xl"/>
                <div>
                  <p:outputLabel id="objectId" value="#{templateBacking.getObjectId()}"
                                 styleClass=""/>
                  <p:commandButton id="btnCopy" icon="pi pi-copy" styleClass="text-xs ui-button-flat" global="false"
                                   rendered="#{not templateBacking.objectBacking.new}" />
                  <pe:clipboard id="clipCopy" trigger="btnCopy" action="copy" target="objectId">
                  </pe:clipboard> 
                </div>
              </div>
            </p:outputPanel>                
          </div>
          <div class="flex flex-row-reverse w-3">
            <div class="m-1">
              <p:commandButton icon="text-lg ui-icon pi pi-cog" styleClass="rounded-button ui-button-flat"
                               title="#{objectBundle.create}" alt="#{objectBundle.create}"/>
            </div>
            <div class="m-1">
              <p:commandButton  icon="text-lg ui-icon pi pi-trash" styleClass="rounded-button ui-button-flat" 
                                action="#{templateBacking.remove}" ajax="false" update="form_panel growl" 
                                title="#{objectBundle.delete}" alt="#{objectBundle.delete}" immediate="true"
                                onclick="return confirm('#{objectBundle.confirm_full_remove}');"/>
            </div>             
            <div class="m-1">
              <p:commandButton  icon="text-lg pi pi-undo" styleClass="rounded-button ui-button-flat"
                                title="#{objectBundle.cancel}" alt="#{objectBundle.cancel}">
                <p:ajax update="form_panel growl" resetValues="true" />
              </p:commandButton>  
            </div>        
            <div class="m-1">
              <p:commandButton icon="text-lg ui-icon pi pi-save" styleClass="rounded-button ui-button-flat" 
                               action="#{templateBacking.store}" ajax="true" update="form_panel object_header growl"
                               title="#{objectBundle.store}" alt="#{objectBundle.store}"/>
            </div>             
            <div class="m-1">
              <p:commandButton icon="text-lg ui-icon pi pi-plus-circle"  styleClass="rounded-button ui-button-flat"
                               action="#{templateBacking.create}" ajax="false" update="form_panel growl"
                               title="#{objectBundle.create}" alt="#{objectBundle.create}"/>
            </div>                                 
          </div>
        </div>
      </f:facet> 

      <p:tabMenu activeIndex="#{templateBacking.tabIndex}">
        <c:forEach items="#{templateBacking.tabs}" var="tab">
          <p:menuitem id="tab#{tab.index}" value="#{tab.label}" ajax="false"
                      actionListener="#{templateBacking.doTabAction}"
                      action="#{tab.executeAction()}" >
            <f:attribute name="tab" value="#{tab}"></f:attribute>
          </p:menuitem>
        </c:forEach>
      </p:tabMenu>
      
      <p:outputPanel styleClass="flex-grow-1 overflow-auto" style="height:60vh"> <!-- TODO adjust to any screen size -->
        <div class="tab p-3">
          <h:panelGroup id="form_panel">
            <ui:insert name="content"></ui:insert>  
          </h:panelGroup>          
        </div>
        <p:scrollTop target="parent" threshold="50" styleClass="custom-scrolltop" icon="pi pi-arrow-up" />
      </p:outputPanel>
      
      <div class="tab_footer text-right pt-3">
        <p:commandButton action="#{templateBacking.store}" value="#{objectBundle.store}" 
                         ajax="true" update="#{updateOnStore != null ? updateOnStore : 'form_panel object_header'} growl"
                         icon="pi pi-save"
                         styleClass="ui-button-raised m-1" />
        <p:commandButton action="#{templateBacking.cancel}" value="#{objectBundle.cancel}" 
                         ajax="true" immediate="true" global="false"
                         update="#{updateOnCancel != null ? updateOnCancel : 'form_panel object_header'} growl"
                         icon="pi pi-undo" styleClass="ui-button-raised m-1">
          <p:ajax update="#{updateOnCancel != null ? updateOnCancel : 'form_panel'} growl" resetValues="true" global="false" />
        </p:commandButton>      
      </div>       
    </p:panel>

  </ui:define>
</ui:composition>

