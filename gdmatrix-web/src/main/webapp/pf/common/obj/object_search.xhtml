<!-- 
  Defines the main region common to all objects on search pages.

  Defines:
    - main
  Inserts:
    - content (results)
-->
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:sf="http://faces.santfeliu.org"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                template="object_common.xhtml">

  <ui:define name="main"> 
    <p:panel id="search_results_panel" header="#{userSessionBean.selectedMenuItem.getProperty('label')}"
             styleClass="object-search-panel">
      <f:facet name="header">
        <div class="flex align-items-center">
          <div class="w-9">
            <p:outputPanel id="object_header" styleClass="flex align-items-center">
              <div>
                <p:outputLabel 
                  value="#{userSessionBean.selectedMenuItem.getProperty('label')}" 
                  styleClass="block text-2xl"/>
              </div>
            </p:outputPanel>                
          </div>

          <div class="flex flex-row-reverse w-3">    
            <div class="m-1">

              <p:menuButton icon="pi pi-file-excel text-xl" styleClass="ui-menu-button ui-button-flat"
                            rendered="#{templateBacking.searchBacking.resultListHelper.rowCount > 0}">
                <p:menuitem title="PDF" value="PDF" icon="pi pi-file-pdf text-xl" styleClass="m-1 ui-button-flat" ajax="false"
                            rendered="#{templateBacking.searchBacking.resultListHelper.rowCount > 0}">
                  <p:dataExporter type="pdf" target="full_results_table" fileName="results" pageOnly="true"/>
                </p:menuitem>
                <p:menuitem title="CSV" value="CSV" icon="pi pi-file-excel text-xl" styleClass="m-1 ui-button-flat" ajax="false"
                            rendered="#{templateBacking.searchBacking.resultListHelper.rowCount > 0}">
                  <p:dataExporter type="csv" target="full_results_table" fileName="results" pageOnly="true" />
                </p:menuitem> 
              </p:menuButton>
              <p:commandButton icon="ui-icon pi pi-plus-circle text-xl" styleClass="m-1 ui-button-flat"
                               action="#{templateBacking.create}" ajax="false" update="form_panel growl"
                               title="#{objectBundle.create}" alt="#{objectBundle.create}"/>             
            </div>              
          </div>
        </div>
      </f:facet>

      <p:outputPanel styleClass="body-content flex-grow-1 overflow-auto">
               
        <ui:insert name="content" />

        <p:dataTable id="full_results_table" value="#{templateBacking.searchBacking.resultListHelper.resultList}" var="row"
                     stripedRows="true" paginator="true" pageLinks="5" resizableColumns="false" showGridlines="true" 
                     paginatorPosition="bottom" size="small" widgetVar="searchResultsTable"
                     first="#{templateBacking.searchBacking.resultListHelper.firstRowIndex}"
                     rows="#{templateBacking.searchBacking.resultListHelper.pageSize}"
                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                     currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} #{objectBundle.results}"
                     rowsPerPageTemplate="5,10,25,50"
                     rendered="#{!userSessionBean.menuModel.selectedMenuItem.properties.renderCustomResults}">   


          <p:columns value="#{templateBacking.searchBacking.resultListHelper.columns}" var="column" 
                     headerText="#{column.label}" field="#{column.property}" style="#{column.style}"
                     filterable="false" sortable="false" resizable="false" >
          </p:columns>

          <p:column styleClass="w-1 text-center" exportable="false">
            <p:commandButton icon="pi pi-pencil" styleClass="ui-button-raised" 
                             action="#{templateBacking.searchBacking.show(row)}" immediate="true" ajax="false" />     
            <p:commandButton icon="pi pi-check" styleClass="ui-button-raised m-1"
                             action="#{templateBacking.searchBacking.select(row)}" immediate="true" ajax="false"
                             rendered="#{templateBacking.searchBacking.selectableObject}"/>                  
          </p:column>

        </p:dataTable>     

      </p:outputPanel>
    </p:panel>
  </ui:define>
</ui:composition>

