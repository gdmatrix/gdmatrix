<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:sf="http://faces.santfeliu.org"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/templates/#{userSessionBean.template}/template.xhtml"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

  <ui:define name="body">

    <h:outputStylesheet library="css" name="object_3col.css" />

    <h:outputScript name="locales/locale-#{userSessionBean.viewLanguage}.js"
                    library="primefaces"/>

    <p:button onclick="return showPanel('leftPanel');"
              icon="pi pi-search"
              widgetVar="leftPanelButton"
              class="side_button left first_time"  />

    <p:button onclick="return showPanel('rightPanel')"
              icon="pi pi-sitemap"
              widgetVar="rightPanelButton"
              class="side_button right first_time" />

    <div class="template-layout flex h-full">

      <div class="col flex slick-columns w-full pl-0 pr-0">
        <!-- Left column -->
        <p:panel id="left_colunn"
                 widgetVar="leftPanel"
                 class="side_panel left m-1 first_time">
          <f:facet name="header">
            <i class="pi pi-search m-1"></i>
            <p:outputLabel value="#{objectBundle.search}" />
            <p:commandLink onclick="return closePanel('leftPanel');"
                           class="ui-panel-titlebar-icon ui-corner-all ui-state-default">
              <span class="ui-icon ui-icon-closethick"></span>
            </p:commandLink>
          </f:facet>

          <ui:insert name="filter"></ui:insert>

        </p:panel>

        <!-- Central column -->
        <p:outputPanel id="central_column"
                       class="central_column flex-grow-1 m-1">
          <h1 class="object_label" style="color:var(--text-color)">
            <h:outputText value="" styleClass="#{userSessionBean.menuModel.selectedMenuItem.properties.icon}" />
            <h:outputText value="#{userSessionBean.menuModel.selectedMenuItem.properties.label}" styleClass="ml-2" />
          </h1>
          <ui:insert name="object"></ui:insert>
        </p:outputPanel>

        <!-- Right column -->
        <p:panel id="right_column"
                 widgetVar="rightPanel"
                 class="side_panel right m-1 first_time">
          <f:facet name="header">
            <i class="pi pi-sitemap m-1"></i>
            <span>#{objectBundle.context}</span>
            <p:commandLink onclick="return closePanel('rightPanel');"
                           class="ui-panel-titlebar-icon ui-corner-all ui-state-default">
              <span class="ui-icon ui-icon-closethick"></span>
            </p:commandLink>
          </f:facet>

          <p:outputPanel id="context_panel">
            <p:tabView styleClass="context_tabs"
                       dynamic="true"
                       activeIndex="#{navigatorBean.contextTabSelector}">

              <p:ajax event="tabChange" process="@this" />

              <p:tab title="#{objectBundle.recent}">
                <p:tree value="#{recentObjectsBean.treeNode}"
                        var="data" nodeVar="node"
                        animate="true"
                        styleClass="recents_tree" >
                  <p:ajax event="expand" listener="#{recentObjectsBean.onNodeExpand}" />
                  <p:ajax event="collapse" listener="#{recentObjectsBean.onNodeCollapse}" />
                  <p:treeNode type="group">
                    <h:outputText value="#{data.description}" />
                  </p:treeNode>
                  <p:treeNode icon="#{node.parent.data.icon}"
                              styleClass="#{recentObjectsBean.isSelectedNode(node) ? 'current' : ''}">
                    <p:commandLink action="#{navigatorBean.show(node.parent.data.baseTypeId, data.objectId)}"
                                   rendered="#{not recentObjectsBean.isCurrentBaseType(node)}"
                                   immediate="true"
                                   ajax="false"
                                   onclick="showOverlay()">
                      <h:outputText value="#{data.description}" />
                    </p:commandLink>
                    <p:commandLink action="#{navigatorBean.view(data.objectId, 0, true)}"
                                   rendered="#{recentObjectsBean.isCurrentBaseType(node)}"
                                   process=":mainform:context_panel"
                                   resetValues="true"
                                   oncomplete="endPanel('rightPanel');"
                                   update=":mainform:central_column :mainform:context_panel">
                      <h:outputText value="#{data.description}" />
                    </p:commandLink>
                  </p:treeNode>
                </p:tree>
              </p:tab>
              <p:tab title="#{objectBundle.history}">
                <div class="history">
                  <ui:repeat value="#{historyBean.entries}"
                            var="leap">
                    <div class="return_info">
                      <p:commandLink action="#{historyBean.show(leap)}"
                                     process="@this"
                                     rendered="#{not historyBean.isCurrentBaseType(leap)}"
                                     immediate="true"
                                     ajax="false"
                                     onclick="showOverlay()">
                        <span class="#{historyBean.getIcon(leap)}" />
                        <h:outputText value="#{historyBean.getDescription(leap)}" />
                      </p:commandLink>
                      <p:commandLink action="#{historyBean.view(leap)}"
                                     process="@this"
                                     rendered="#{historyBean.isCurrentBaseType(leap)}"
                                     resetValues="true"
                                     oncomplete="endPanel('rightPanel');"
                                     update=":mainform:central_column :mainform:context_panel">
                        <span class="#{historyBean.getIcon(leap)}" />
                        <h:outputText value="#{historyBean.getDescription(leap)}" />
                      </p:commandLink>
                    </div>
                  </ui:repeat>
                </div>
              </p:tab>
              <p:tab id="favorites">
                <f:facet name="title">
                  <span class="pi pi-star-fill mr-2"/>
                  <h:outputText value="#{objectBundle.favorites}" />
                </f:facet>
                <div class="favorites">
                  <ui:repeat value="#{favoriteObjectsBean.favoriteObjects}"
                            var="favorite">
                    <div class="favorite">
                      <span class="#{favoriteObjectsBean.icon}" />
                      <p:commandLink action="#{navigatorBean.view(favorite.objectId, 0, true)}"
                                     process="@this"
                                     resetValues="true"
                                     oncomplete="endPanel('rightPanel');"
                                     update=":mainform:central_column :mainform:context_panel">
                        <h:outputText value="#{favorite.description}"
                                      styleClass="#{favoriteObjectsBean.isSelectedObject(favorite) ? 'current' : ''}"/>
                      </p:commandLink>
                    </div>
                  </ui:repeat>
                </div>
              </p:tab>

            </p:tabView>
          </p:outputPanel>
        </p:panel>
      </div>

      <script>
        function showPanel(panelVar)
        {
          var panel = PF(panelVar);
          var panelButton = PF(panelVar + "Button");
          panel.show();
          panel.getJQ().removeClass("first_time");
          panelButton.getJQ().removeClass("first_time");
          panelButton.getJQ().css("display", "none");
          return false;
        }

        function closePanel(panelVar)
        {
          var panel = PF(panelVar);
          var panelButton = PF(panelVar + "Button");
          panel.close();
          panelButton.getJQ().css("display", "block");
          return false;
        }

        function endPanel(panelVar)
        {
          if (700 > window.innerWidth)
          {
            closePanel(panelVar);
          }
        }
      </script>

    </div>

  </ui:define>

</ui:composition>



