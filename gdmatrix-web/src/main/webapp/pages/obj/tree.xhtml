<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    
  <p:tab title="Tree">
    <p:tree value="#{contextTreeBean.treeNode}" id="context_tree"
            var="data" nodeVar="node" dynamic="true" cache="false"
            animate="true" styleClass="mt-4 context_tree"
            selectionMode="single" widgetVar="contextTree"
            selection="#{contextTreeBean.selectedNode}">
      
      <p:ajax event="expand"
              onstart="if (_pointerSource.classList.contains('ui-tree-toggler')) {_pointerSource.classList.remove('ui-icon-triangle-1-e');_pointerSource.classList.add('pi', 'pi-spinner', 'pi-spin');}"
              oncomplete="if (_pointerSource.classList.contains('ui-tree-toggler')) {_pointerSource.classList.remove('pi', 'pi-spinner', 'pi-spin');}"
              global="false" />

      <p:ajax event="collapse" />
      
      <p:ajax event="contextMenu"
              update="@parent:context_tree_menu" />      
      
      <p:treeNode icon="#{data.icon}"
                  styleClass="#{contextTreeBean.isSelectedNode(node) ? 'current' : ''}">
        <p:commandLink value="#{data.description}"
                       action="#{contextTreeBean.view(node)}"
                       rendered="#{contextTreeBean.isCurrentBaseType(node)}"
                       process=":mainform:context_panel"
                       resetValues="true"
                       oncomplete="endPanel('rightPanel');"
                       update=":mainform:central_column :mainform:context_panel" />
        <p:commandLink value="#{data.description}" 
                       action="#{contextTreeBean.show(node)}" 
                       immediate="true"
                       rendered="#{not contextTreeBean.isCurrentBaseType(node)}"
                       ajax="false" 
                       onclick="showOverlay()" />
        
      </p:treeNode>
    </p:tree>
    
    <p:contextMenu for="context_tree" id="context_tree_menu" 
                   rendered="#{not empty contextTreeBean.contextActions}">
      <c:forEach items="#{contextTreeBean.contextActions}" var="contextAction" >
        <c:if test="#{contextAction.type == 'ADD'}">
          <p:menuitem value="#{contextAction.label}" 
                      action="#{contextTreeBean.doContextAction(contextAction)}"
                      immediate="true" ajax="false" />
        </c:if>
        <c:if test="#{contextAction.type != 'ADD'}">
          <p:menuitem value="#{contextAction.label}" 
                      action="#{contextTreeBean.doContextAction(contextAction)}" 
                      update="context_tree" />
        </c:if>
      </c:forEach>
    </p:contextMenu>
    
    <p:commandButton action="#{contextTreeBean.update}"
                     styleClass="mt-4"
                     value="Refresh"
                     process="@this"
                     update=":mainform:context_panel" />
  </p:tab>

</ui:composition>



