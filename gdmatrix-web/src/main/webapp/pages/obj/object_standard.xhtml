<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:p="http://primefaces.org/ui">

  <p:outputPanel id="object_header" class="flex flex-wrap card-container m-2">
    <p:outputPanel class="flex flex-grow-0 justify-content-start align-self-center"
                   rendered="#{objectBean.finderBean.isScrollEnabled()}">
        <p:commandButton icon="ui-icon pi pi-step-backward"
                         styleClass="rounded-button ui-button-flat mr-2"
                         action="#{objectBean.finderBean.viewPrevious}"
                         process="@this"
                         update="@form:cnt:context_panel @form:cnt:search_tabs:obj_tabs"
                         resetValues="true"
                         disabled="#{not objectBean.finderBean.hasPrevious()}"
                         title="#{objectBundle.previous}" alt="#{objectBundle.previous}"
                         />
        <h:outputText value="#{objectBean.finderBean.objectPosition + 1} / #{objectBean.finderBean.objectCount}"
                      styleClass="align-self-center" />
        <p:commandButton icon="ui-icon pi pi-step-forward"
                         styleClass="rounded-button ui-button-flat ml-2 mr-2"
                         action="#{objectBean.finderBean.viewNext}"
                         process="@this"
                         update="@form:cnt:context_panel @form:cnt:search_tabs:obj_tabs"
                         resetValues="true"
                         disabled="#{not objectBean.finderBean.hasNext()}"
                         title="#{objectBundle.next}" alt="#{objectBundle.next}"
                         />
    </p:outputPanel>
    <div class="flex flex-grow-1 justify-content-start align-self-center">
      <h:outputText value="#{objectBean.objectId}" />
      <strong><h:outputText value="#{objectBean.description}" class="ml-2"/></strong>
    </div>
    <div class="flex flex-grow-1 justify-content-end">
        <p:commandButton icon="ui-icon pi pi-arrow-circle-left"
                         styleClass="rounded-button ui-button-flat"
                         action="#{navigatorBean.select}"
                         process="@this"
                         update="@form:cnt"
                         rendered="#{navigatorBean.selectable}"
                         title="#{objectBundle.select}" alt="#{objectBundle.select}"
                         />
        <p:commandButton icon="ui-icon pi pi-plus-circle"
                         styleClass="rounded-button ui-button-flat"
                         action="#{navigatorBean.view('')}"
                         process="@this"
                         update="@form:cnt:context_panel @form:cnt:search_tabs:obj_tabs"
                         resetValues="true"
                         title="#{objectBundle.create}" alt="#{objectBundle.create}"
                         disabled="#{!objectBean.editable}" />
        <p:commandButton icon="ui-icon pi pi-star"
                         styleClass="rounded-button ui-button-flat"
                         action="#{navigatorBean.baseTypeInfo.markAsFavorite}"
                         rendered="#{not objectBean.isNew() and not navigatorBean.baseTypeInfo.markedAsFavorite}"
                         process="@this"
                         update="object_header @form:cnt:context_panel"
                         partialSubmit="true"
                         title="#{objectBundle.favorite}" alt="#{objectBundle.favorite}"
                         />
        <p:commandButton icon="ui-icon pi pi-star-fill"
                         styleClass="rounded-button ui-button-flat"
                         action="#{navigatorBean.baseTypeInfo.unmarkAsFavorite}"
                         rendered="#{not objectBean.isNew() and navigatorBean.baseTypeInfo.markedAsFavorite}"
                         process="@this"
                         update="object_header @form:cnt:context_panel"
                         partialSubmit="true"
                         title="#{objectBundle.noFavorite}" alt="#{objectBundle.noFavorite}"
                         />
        <p:commandButton icon="ui-icon pi pi-trash"
                         styleClass="rounded-button ui-button-flat"
                         action="#{objectBean.remove}"
                         rendered="#{not objectBean.isNew()}"
                         process="@this"
                         update="@form:cnt:search_tabs @form:cnt:context_panel"
                         resetValues="true"
                         title="#{objectBundle.delete}" alt="#{objectBundle.delete}"
                         disabled="#{!objectBean.editable}">
            <p:confirm header="#{objectBundle.confirm_remove_header}" 
                       message="#{objectBundle.confirm_remove_message}" 
                       icon="pi pi-info-circle" />
        </p:commandButton>

        <p:menuButton icon="ui-icon pi pi-cog" buttonStyleClass="rounded-button ui-button-flat"
                      title="#{objectBundle.actions}" 
                      rendered="#{not empty objectBean.objectSetup.scriptActions.actions}">
          <c:forEach items="#{objectBean.objectSetup.scriptActions.actions}" var="action" >
            <p:menuitem icon="#{action.icon}" 
                        value="#{action.label}" action="#{objectBean.callAction(action.name)}" 
                        rendered="#{not empty action.label}" process="@this"
                        update="@form:cnt:search_tabs:tabs"/>
          </c:forEach>
        </p:menuButton> 
        
        <p:commandButton icon="ui-icon pi pi-times"
                         action="#{navigatorBean.close}"
                         process="@this" update="@form:cnt"
                         styleClass="rounded-button ui-button-flat"
                         title="#{objectBundle.close}" alt="#{objectBundle.close}" />
    </div>
  </p:outputPanel>


  <f:metadata>
    <f:viewAction action="#{objectBean.selectTabWithErrors}"
                  onPostback="true" phase="PROCESS_VALIDATIONS" />

    <f:viewAction action="#{objectBean.loadActiveEditTab}"
                  onPostback="true" />
  </f:metadata>

  <p:tabView dynamic="true"
             cache="true"
             id="tabs"
             widgetVar="objectTabs"
             touchable="false"
             activeIndex="#{objectBean.editTabSelector}">
    <p:ajax event="tabChange" process="@this" update="@none" />
    <c:forEach items="#{objectBean.editTabs}" var="tab" >
      <p:tab title="#{applicationBean.translate(tab.label, userSessionBean.translationGroup)}"
             disabled="#{objectBean.isDisabledEditTab(tab)}"
             rendered="#{objectBean.isRenderedEditTab(tab)}">
        <ui:include src="#{tab.viewId}" />
      </p:tab>
    </c:forEach>
  </p:tabView>

  <c:forEach items="#{objectBean.dialogViewIds}" var="dialogViewId" >
    <ui:include src="#{dialogViewId}" />    
  </c:forEach>
  
  <div class="tab_footer text-right pt-3">
    <p:commandButton id="store"
                     action="#{objectBean.store}"
                     value="#{objectBundle.store}"
                     icon="pi pi-save"
                     process="@form:cnt:search_tabs:obj_tabs"
                     update="@form:cnt:search_tabs:obj_tabs @form:cnt:context_panel"
                     styleClass="m-1" 
                     disabled="#{!objectBean.editable}" />
    <p:commandButton action="#{objectBean.cancel}"
                     value="#{objectBundle.cancel}"
                     icon="pi pi-undo"
                     process="@this"
                     styleClass="m-1"
                     update="@form:cnt:search_tabs:obj_tabs"
                     resetValues="true"
                     global="false" 
                     disabled="#{!objectBean.editable}" />
  </div>

  <h:outputText value="#{navigatorBean.urlChangeScript}" escape="false" />
  
</ui:composition>

